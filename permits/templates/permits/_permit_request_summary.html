{% load i18n %}
{% load bootstrap4 %}
{% load permits_extras %}

<div class="container">
  <div class="row">
    <div class="col">
      {% for object, properties, appendices, amend_custom_properties in objects_infos %}

        <h4 class="workObjectHeader"> {{ object }} </h4>
        <div class="container">
          <dl class="properties-list">
            {% for field in properties %}
              {% if field.label %}
                <dt> {{ field.label }} </dt>
                <dd> {{ field.value|human_field_value }} </dd>
              {% else %}
                <dt style="white-space: nowrap;">{{ field.repr|safe }}</dt>
                <dd></dd>
              {% endif %}
            {% endfor %}

            {% for field in appendices %}
              <dt>{{ field.label }}</dt>
              <dd>
                {% if not field.value %}
                  <em>{% trans "Information non fournie" %}</em>
                {% else %}
                  <a href="{{ field.value.url }}" rel="noreferrer" target="_blank">{{ field.value.name|basename }}</a>
                {% endif %}
              </dd>
            {% endfor %}
          </dl>
        </div>

        {% if amend_custom_properties %}
          <div class="container">
            <h5>{% trans "Informations du service responsable" %}</h5>
            {% for object_property in amend_custom_properties %}
              {% if object_property.property.is_visible_by_author %}
                <dl class="properties-list">
                  <dt class="amend-property">{{ object_property.property }}</dt>
                  <dd>{{ object_property.value }}</dd>
                </dl>
              {% endif %}
            {% endfor %}
          </div>
        {% endif %}
      {% endfor %}
    </div>
  </div>


  {% if contacts %}

    <div class="row">
      <div class="col">
        <div class="container">
          <h4>{% trans "Contacts" %}</h4>
            <dl>
              {% if requires_payment %}
                <dt>Destinataire de la facture</dt>
                <dd> {{ creditor }} </dd>
              {% endif %}
            </dl>
        </div>

          {% for contact_type, contact_infos in contacts %}
          <h5>{{ contact_type }}</h5>
            <div class="row">
              <div class="col">
                <div class="grid-container">
                  {% for field_label, field_value in contact_infos %}
                    {% if field_value %}
                    <div class="grid-element">
                      <dl>
                         <dt> {{ field_label }} </dt>
                         <dd> {{ field_value }} </dd>
                      </dl>
                    </div>
                    {% endif %}
                  {% endfor %}
                </div>
              </div>
            </div>
          {% endfor %}

      </div>
    </div>

  {% endif %}


  <div class="row">
    <div class="col">
      {% if intersected_geometries %}
        <h4>{% trans "Éléments géographiques touchés par la demande (automatique)" %}</h4>
        {{ intersected_geometries|safe }}
      {% endif %}
    </div>
  </div>

  <div class="row">
    <div class="col">
      {% for geo_time_form in geo_time_formset %}
        {{ geo_time_form.media }}
        {% include "permits/_geo_time_form.html" with form=geo_time_form form_id=forloop.counter0 form_number=forloop.counter open=True %}
      {% endfor %}
    </div>
  </div>


</div>
